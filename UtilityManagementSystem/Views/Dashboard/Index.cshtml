
@model UtilityManagementSystem.ViewModels.DashboardViewModel

<!-- Inline styles: stronger outlines, hover glow, dark-mode compatible -->
<style>
  /* Base hover effect */
  .card.card-hover {
    transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
    will-change: transform, box-shadow;
  }
  .card.card-hover:hover {
    transform: translateY(-2px);
  }

  /* Stronger default outline */
  .card.card-hover {
    border: 1px solid var(--bs-border-color);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  }

  /* Utility-colored outlines (visible & consistent) */
  .outline-primary { border-color: var(--bs-primary) !important; }
  .outline-success { border-color: var(--bs-success) !important; }
  .outline-danger  { border-color: var(--bs-danger)  !important; }
  .outline-warning { border-color: var(--bs-warning) !important; }

  /* Hover glow per utility color (brand-tinted) */
  .card.card-hover.outline-primary:hover {
    box-shadow: 0 0 0 2px rgba(13, 110, 253, 0.25), 0 8px 20px rgba(0,0,0,0.10);
  }
  .card.card-hover.outline-success:hover {
    box-shadow: 0 0 0 2px rgba(25, 135, 84, 0.25), 0 8px 20px rgba(0,0,0,0.10);
  }
  .card.card-hover.outline-danger:hover {
    box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.25), 0 8px 20px rgba(0,0,0,0.10);
  }
  .card.card-hover.outline-warning:hover {
    box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.35), 0 8px 20px rgba(0,0,0,0.10);
  }

  /* Dark mode tuning: soften base shadow; keep glow readable */
  [data-bs-theme="dark"] .card.card-hover {
    box-shadow: 0 1px 4px rgba(0,0,0,0.45);
  }

  /* Chart wrapper: matching width and comfortable height */
  .chart-wrap {
    height: 320px;
    position: relative;
  }
  .chart-wrap canvas {
    display: block !important;
    width: 100% !important;
    height: 100% !important;
  }

  /* Compact spacing */
  .ums-content > .card { margin-bottom: 0.75rem; }
  .ums-content .row.g-3 { row-gap: 0.75rem; }

  /* Dark mode: table header shouldn’t be bright white */
  [data-bs-theme="dark"] thead.table-light {
    background-color: var(--bs-secondary-bg) !important;
    color: var(--bs-body-color) !important;
    border-color: var(--bs-border-color) !important;
  }

  /* Slightly smaller metrics on wide screens to help fit */
    @@media (min-width: 992px) {
    .metric-num.fs-3 { font-size: 1.6rem; }
  }
</style>

<div class="container-fluid ums-container ums-content">
    <!-- Page Title -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="fw-semibold mb-0">Dashboard</h2>
    </div>

    <!-- Summary Cards -->
    <div class="row g-3 mb-3">
        <div class="col-12 col-md-6 col-lg-3">
            <div class="card shadow-sm rounded-lg text-center p-3 h-100 card-hover outline-primary">
                <div class="text-primary mb-2"><i class="bi bi-people" style="font-size: 1.8rem;"></i></div>
                <div class="text-body-secondary">Total Customers</div>
                <div class="fs-3 fw-bold metric-num">@Model.TotalCustomers</div>
            </div>
        </div>

        <div class="col-12 col-md-6 col-lg-3">
            <div class="card shadow-sm rounded-lg text-center p-3 h-100 card-hover outline-success">
                <div class="text-success mb-2"><i class="bi bi-speedometer2" style="font-size: 1.8rem;"></i></div>
                <div class="text-body-secondary">Total Meters</div>
                <div class="fs-3 fw-bold metric-num">@Model.TotalMeters</div>
            </div>
        </div>

        <div class="col-12 col-md-6 col-lg-3">
            <div class="card shadow-sm rounded-lg text-center p-3 h-100 card-hover outline-danger">
                <div class="text-danger mb-2"><i class="bi bi-exclamation-circle" style="font-size: 1.8rem;"></i></div>
                <div class="text-body-secondary">Pending Bills</div>
                <div class="fs-3 fw-bold metric-num">@Model.PendingBills</div>
            </div>
        </div>

        <div class="col-12 col-md-6 col-lg-3">
            <div class="card shadow-sm rounded-lg text-center p-3 h-100 card-hover outline-warning">
                <div class="text-warning mb-2"><i class="bi bi-currency-dollar" style="font-size: 1.8rem;"></i></div>
                <div class="text-body-secondary">Payments This Month</div>
                <div class="fs-4 fw-bold">Rs. @Model.TotalPaymentsThisMonth</div>
            </div>
        </div>
    </div>

    <!-- Recent Payments (above chart; full width) -->
    <div class="card shadow-sm rounded-lg mb-3 card-hover">
        <div class="card-header fw-semibold">Recent Payments</div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Customer</th>
                            <th>Amount</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var p in Model.RecentPayments)
                        {
                                <tr>
                                    <td>@p.CustomerName</td>
                                    <td>Rs. @p.Amount</td>
                                    <td>@p.Date.ToString("dd MMM yyyy")</td>
                                </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Revenue Chart (full width; matches table/card width) -->
    <div class="card shadow-sm rounded-lg mb-3 card-hover">
        <div class="card-header fw-semibold">Revenue — Last 6 Months</div>
        <div class="card-body chart-wrap">
            <canvas id="revenueChart"></canvas>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  (function () {
    const el = document.getElementById('revenueChart');
    if (!el) return;

    const data = {
      labels: @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.RevenueMonths)),
      datasets: [{
        label: 'Revenue (Rs.)',
        data: @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.RevenueValues)),
        backgroundColor: 'rgba(13,110,253,0.65)', // Bootstrap primary-ish
        borderRadius: 6,
        maxBarThickness: 48
      }]
    };

    const options = {
      responsive: true,
      maintainAspectRatio: false, // canvas fills .chart-wrap height
      plugins: {
        legend: { display: false },
        tooltip: { mode: 'index', intersect: false }
      },
      scales: {
        x: { grid: { display: false } },
        y: {
          beginAtZero: true,
          grid: { color: 'rgba(0,0,0,0.08)' },
          ticks: { precision: 0 }
        }
      }
    };

    new Chart(el, { type: 'bar', data, options });
  })();
</script>
